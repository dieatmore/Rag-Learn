# RAG-检索增强生成

## 📝 OVERVIEW

RAG的学习记录：了解RAG，测试并完成一个RAG的使用。

### 🛠️ Development Tools

- spring-boot
- spring-ai
- qdrant 向量数据库

### 🤖 MODEL

选用阿里text-embedding-v4向量模型，1024维度。

<hr/>

###  ❓ Testings


1. `如何添加用户？`

   + 管理员可以通过该模块添加新用户, score: 0.8232988119125366
   + 管理员功能模块，添加用户功能, score: 0.6546160578727722
   + 管理员功能模块，更改用户权限, score: 0.5420510768890381
   + 你好，世界, score: 0.29887068271636963

> + <font size="3">管理员可以通过该模块添加新用户：文本语义与检索词完全贴合</font>
> + <font size="3">管理员功能模块，添加用户功能：语义仍关联 “添加用户”，但贴合度略低，侧重“功能”，文本冗余 / 碎片化，语义被稀释</font>
> + <font size="3">管理员功能模块，更改用户权限：核心动作偏离，但业务场景仍关联</font>
> + <font size="3">你好，世界：与检索词无任何语义关联，得分接近 0.3，仅代表 “向量空间中无意义的基础相似度”（所有文本向量与任意检索词向量都会有极低的默认相似度），无实际业务意义。</font>

2. `苹果 手机`

   + Apple手机, score: 0.8166669607162476
   + 苹果手机, score: 0.8148566484451294 
   
     > <font size="3">得分略低的原因：仅因嵌入模型对中英文品牌词编码的极细微差异（无业务层面的区别），整体仍属于 “核心匹配” 范畴。</font>
   + 苹果正品手机, score: 0.8065965175628662

     > <font size="3">"正品" 冗余修饰词稀释核心语义</font>
   + iPhone手机, score: 0.7403218746185303

     > <font size="3">语义范围缩小，“iPhone” 是苹果品牌下的具体产品系列（而非品牌本身）</font>
   + 华为手机, score: 0.6459783315658569
   + OPPO手机, score: 0.6293975710868835
   + 小米手机, score: 0.6134622097015381
   + iPhone 16 Pro Max 旗舰新品, score: 0.47404536604881287

     > <font size="3">大量冗余信息严重稀释核心语义,关键词仅占语义的一部分，冗余信息会彻底拉低匹配度</font>
   + 你好，世界, score: 0.40358448028564453
   

### ✅ DETAIL

##### 一、比赛目录 test
+ 三个等级比赛目录，一个等级一段（第三等级一段有五十多个比赛）
  + 1. "全国大学生软件创新大赛"
       + 第三等级score: 0.6248294115066528
       + 第二等级score: 0.594414234161377  <font size="3">（正确）</font>
       + 第一等级score: 0.5264873504638672
  + 2. "全国大学生工业设计大赛"
       + 第三等级score: 0.6173943877220154  <font size="3">（正确） </font>
       + 第二等级score: 0.5832704305648804
       + 第一等级score: 0.5033977031707764
  + 3. "蓝桥杯是什么比赛"
       + 第三等级score: 0.497569739818573 <font size="3"> （正确） </font>
       + 第二等级score: 0.47684207558631897
       + 第三等级score: 0.4593309164047241
       
<br/>     
<br/>     

+ 三个等级比赛目录，7~8个比赛一段（第三等级有8段）
  + 1. "全国大学生软件创新大赛"
       + 第二等级(某段)score: 0.6226876378059387 <font size="3"> （正确） </font>
       + 第三等级(某段)score: 0.6088396310806274
       + 第三等级(某段)score: 0.594118595123291
  + 2. "全国大学生工业设计大赛"
       + 第三等级(某段)score: 0.6241661310195923
       + 第三等级(某段)score: 0.6048571467399597
       + 第二等级(某段)score: 0.5808905959129333
       + 第三等级(某段)score: 0.5807852149009705 <font size="3"> （正确） </font>
  + 3. "蓝桥杯是什么比赛"
       + 第三等级(某段)score: 0.5459176301956177
       + 第三等级(某段)score: 0.5451034307479858 <font size="3"> （正确） </font>
       + 第三等级(某段)score: 0.5154807567596436
  + 4. "全国大学生工业设计大赛是什么比赛？"
       + 第三等级(某段)score: 0.6899532079696655
       + 第三等级(某段)score: 0.6692834496498108
       + 第三等级(某段)score: 0.650834321975708 <font size="3"> （正确） </font>
  + 5. "全国大学生工业设计大赛是第二等级的吗？"
       + 第二等级(某段)score: 0.7333270311355591
       + 第三等级(某段)score: 0.7263755202293396
       + 第二等级(某段)score: 0.7066514492034912
       + 第三等级(某段)score: 0.7004486322402954 <font size="3"> （正确） </font>
       > topK(3) --- answer: 不知道

<br/>     
<br/>

+ 三个等级比赛目录，按类分段（创新创业 | 设计 | 机器人 | 挑战 | 其它）
  + 1. "全国大学生软件创新大赛"
       + 第二等级(某段)score: 0.6230800151824951 <font size="3"> （正确） </font>
       + 第三等级(某段)score: 0.6214470863342285 <font size="3"> （创新创业类） </font>
       + 第三等级(某段)score: 0.5918700695037842 <font size="3"> （其它类） </font>
  + 2. "全国大学生工业设计大赛"
       + 第三等级(某段)score: 0.6649260520935059 <font size="3"> （正确） </font>
       + 第二等级(某段)score: 0.5833044648170471 <font size="3"> （设计类） </font>
       + 第三等级(某段)score: 0.5831056833267212 <font size="3"> （创新创业类） </font>
  + 3. "蓝桥杯是什么比赛"
       + 第三等级(某段)score: 0.5147182941436768 <font size="3"> （正确） </font>
         > <font size="3">蓝桥杯在其它类段里，由于其它类比赛信息太杂，所以相似度低</font>
       
       + 第三等级(某段)score: 0.5085140466690063 <font size="3"> （机器人类） </font>
       + 第三等级(某段)score: 0.5046647787094116 <font size="3"> （挑战类） </font>
  + 4. "全国大学生工业设计大赛是第二等级的吗？"
       + 第三等级(某段)score: 0.7437910437583923 <font size="3"> （正确） </font>
       + 第二等级(某段)score: 0.7310258150100708 <font size="3"> （设计类） </font>
       > <font size="3">错误问题引导检索</font>

<br/>     
<br/>
<br/>

##### 二、推免规则 test
 
<br/>

第一次推免规则分太细了，导致询问"蓝桥杯二等奖可以得多少分时？",检索出来的前六七个向量都是匹配推免规则的，没有匹配到比赛目录蓝桥杯。

<br/>

第二次将推免规则按照二级指标点分割段落，询问"某某奖项二等奖可以多少分？"时，如果是其它类的比赛则前几个匹配的都是推免规则向量，分数占比更高

> 将topK(3)调整为topK(5)
> 
> 其它类比赛目录再细分提高相似度

<br/>

1. "全国大学生软件创新大赛"
   + 第三等级(某段)score: 0.6855349540710449 <font size="3"> （正确） </font>
   + 第二等级(某段)score: 0.6038179993629456 <font size="3"> （创新创业类） </font>
   + 第一等级score: 0.5539847612380981

<br/>

2. "全国大学生软件创新大赛可以得多少分？"
   > answer:
   > 
   > 全国大学生软件创新大赛属于第二等级学科竞赛。根据奖项等级，得分如下：
   > 
   >  -第一等奖：总分40分，限1项
   > 
   >  -第二等奖：总分30分，限1项 
   > 
   > 仅限个人项目或集体项目获得国际或国家竞赛二等奖及以上者申报，且同一项竞赛不累计计分，取最高等级计分。
   + 高水平学科竞赛**规则**,score: 0.554253339767456 <font size="3"> （正确） </font>
   + 第二等级(某段)score: 0.554253339767456 <font size="3"> （正确） </font>
   + 学术专长**规则**,score: 0.544765293598175

<br/>

3. "全国大学生软件创新大赛二等奖可以得多少分？"
   > answer:
   > 
   > 全国大学生软件创新大赛属于第二等级学科竞赛。根据规则，第二等级竞赛的二等奖得分为30分。
   + 高水平学科竞赛**规则**,score: 0.5920986533164978 <font size="3"> （正确） </font>
   + 第二等级(某段)score: 0.5550552606582642 <font size="3"> （正确） </font>
   + 学术专长**规则**,score: 0.5170667171478271

<br/>

4. "蓝桥杯一等奖可以得多少分啊？" --(缩小其它类段的长度为三个比赛，相似度显著提高)
   > answer:
   >
   >  蓝桥杯一等奖属于第三等级学科竞赛的第一等奖，得分为30分。

<br/>

 修改前:
 + 高水平学科竞赛**规则**,score: 0.544950008392334 <font size="3"> （正确） </font>
 + 学术专长**规则**,score: 0.4758078455924988
 + 高质量论文**规则**,score: 0.453511118888855
 + 第三等级(某段)score: 0.4044959545135498
 + 第二等级(某段)score: 0.39912331104278564
 + 第三等级(某段)score: 0.3974771499633789
 + 第三等级(某段)score: 0.3927708566188812
 + 第二等级(某段)score: 0.3894224464893341
 + 第一等级score: 0.38796889781951904
 + 第三等级(某段)score: 0.38075727224349976 <font size="3"> （正确） </font>
 
> 匹配其它类段的比赛效果不好，将其它类按每三个比赛分一个段

<br/>

 修改后:
   + 高水平学科竞赛**规则**,score: 0.544950008392334 <font size="3"> （正确） </font>
   + 学术专长**规则**,score: 0.4758078455924988
   + 高质量论文**规则**,score: 0.453511118888855
   + 第三等级(某段)score: 0.4374549984931946 <font size="3"> （正确） </font>

<br/>
   
如果单个比赛作为一段的话:

  "蓝桥杯一等奖可以得多少分啊？"

+ 蓝桥杯, score: 0.5617063641548157
+ 蓝桥杯全国软件和信息技术专业人才大赛, score: 0.5442405939102173

相似度也不是很高，但是比三个比赛一段的 score: 0.4374549984931946 好很多


<br/>     
<br/>
<br/>

#### 细则
  
<br/>

1. "软件创新大赛第五名可以得多少分？"
   > answer:
   > 
   > 1. 全国大学生软件创新大赛属于第二等级学科竞赛。根据规则，第二等级竞赛的第二等奖得分为30分。由于第五名未明确对应奖项等级，但通常低于二等奖，则不满足计分条件。因此，软件创新大赛第五名不得分。
   > 
   > <br/>
   >
   > 2. 全国大学生软件创新大赛属于第二等级学科竞赛。根据规则，第二等级竞赛的第二等奖得分为30分。由于第五名通常对应二等奖或以下奖项，因此软件创新大赛第五名得分为30分。

信息不明确，两次提问出现两个答案: 规则中没有明确分一二等奖的细则

<br/>

2. "软件创新大赛二等奖团体内第五名可以得多少分？"
   > answer:
   > 
   >   软件创新大赛属于第二等级学科竞赛。根据规则，第二等级的二等奖得分为30分。但由于是集体项目，主力成员仅认定前两名，而该学生为团队第五名，不属于主力成员认定范围，因此不能获得分数。
   
